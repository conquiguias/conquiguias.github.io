<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Panel del Usuario</title>
  <style>
    /* Reset b√°sico */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Body y contenedor principal */
    body {
      display: flex;
      height: 100vh;
      background: #eef2f7;
      color: #333;
    }

    /* Men√∫ lateral */
    #sidebar {
      width: 220px;
      background: linear-gradient(180deg, #1976d2, #1565c0);
      color: #fff;
      display: flex;
      flex-direction: column;
      padding: 20px 0;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    }

    #sidebar h2 {
      text-align: center;
      margin-bottom: 25px;
      font-size: 22px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    #sidebar button {
      padding: 12px 20px;
      margin: 5px 10px;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      cursor: pointer;
      text-align: left;
      font-size: 15px;
      transition: background 0.3s, transform 0.2s;
    }

    #sidebar button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(5px);
    }

    #sidebar button.active {
      background: rgba(255, 255, 255, 0.3);
      font-weight: bold;
    }

    #sidebar #logoutBtn {
      margin-top: auto;
      background: #e53935;
    }

    #sidebar #logoutBtn:hover {
      background: #b71c1c;
      transform: translateX(0);
    }

    /* Contenido principal */
    #mainContent {
      flex: 1;
      padding: 25px;
      overflow-y: auto;
    }

    /* Cards */
    .card {
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
      max-width: 650px;
      margin: 20px auto;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
    }

    /* Inputs y selects */
    input,
    select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      transition: border 0.3s, box-shadow 0.3s;
    }

    input:focus,
    select:focus {
      border-color: #1976d2;
      box-shadow: 0 0 5px rgba(25, 118, 210, 0.5);
      outline: none;
    }

    /* Botones */
    button.saveBtn,
    button#crearEspecialidad,
    button#subirArchivoBtn {
      background: #1976d2;
      color: #fff;
      cursor: pointer;
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-size: 15px;
      transition: background 0.3s, transform 0.2s;
    }

    button.saveBtn:hover,
    button#crearEspecialidad:hover,
    button#subirArchivoBtn:hover {
      background: #125aa0;
      transform: translateY(-2px);
    }

    /* Bot√≥n eliminar foto */
    #removePhoto {
      background: #e53935;
      margin-top: 5px;
    }

    #removePhoto:hover {
      background: #b71c1c;
      transform: translateY(-2px);
    }

    /* Listas de archivos y especialidades */
    ul {
      list-style: none;
      padding-left: 0;
      margin-top: 10px;
    }

    ul li {
      padding: 10px 12px;
      border-radius: 6px;
      margin-bottom: 6px;
      background: #f4f6f8;
      transition: background 0.3s;
    }

    ul li:hover {
      background: #e0e7f1;
    }

    ul li a {
      text-decoration: none;
      color: #1976d2;
      font-weight: 500;
    }

    ul li a:hover {
      text-decoration: underline;
    }

    /* Encabezados */
    h2,
    h3,
    h4 {
      color: #333;
      margin-bottom: 15px;
    }

    /* Ocultar secciones */
    .hidden {
      display: none;
    }

    .carpeta-item {
      cursor: pointer;
      background: #f3f3f3;
      margin: 6px 0;
      padding: 10px;
      border-radius: 8px;
      transition: background 0.3s;
    }

    .carpeta-item:hover {
      background: #dce8ff;
    }

    .archivo-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f9fa;
      padding: 8px 12px;
      border-radius: 6px;
      margin: 5px 0;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .archivo-item a {
      color: #007bff;
      text-decoration: none;
      font-weight: 500;
    }

    .archivo-item a:hover {
      text-decoration: underline;
    }

    .delete-btn {
      border: none;
      background: transparent;
      font-size: 18px;
      cursor: pointer;
      color: #e74c3c;
      transition: transform 0.2s;
    }

    .delete-btn:hover {
      transform: scale(1.2);
    }

    /* üîπ Fondo del visor */
    #pdfViewerModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    /* üîπ Contenedor del visor */
    .pdf-viewer-content {
      position: relative;
      width: 90%;
      height: 90%;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.3s ease;
    }

    /* üîπ Bot√≥n de cerrar */
    .cerrar-pdf {
      position: absolute;
      top: 10px;
      right: 15px;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 18px;
      cursor: pointer;
      z-index: 10;
      transition: background 0.3s;
    }

    .cerrar-pdf:hover {
      background: #c0392b;
    }

    /* üîπ PDF dentro del visor */
    .pdf-viewer-content iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* üîπ Animaci√≥n */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    #ordenContainer {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #ordenSelect {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    /* üîπ Fondo del modal */
    #mensajeModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    /* üîπ Caja del mensaje */
    .mensaje-content {
      background: #fff;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
      text-align: center;
      width: 90%;
      max-width: 400px;
      animation: fadeIn 0.25s ease;
    }

    .mensaje-content h3 {
      margin-bottom: 12px;
      color: #1976d2;
    }

    .mensaje-content p {
      margin-bottom: 20px;
      color: #333;
    }

    /* üîπ Botones */
    #mensajeBotones {
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    #mensajeBotones button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      transition: transform 0.2s, background 0.3s;
    }

    #mensajeAceptar {
      background: #1976d2;
      color: white;
    }

    #mensajeCancelar {
      background: #e53935;
      color: white;
    }

    #mensajeBotones button:hover {
      transform: scale(1.05);
    }

    .hiddenX {
      display: none !important;
    }

    /* Niveles en filas de 3 */
    .niveles {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .nivel {
      flex: 1;
      padding: 12px;
      background: #1976d2;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .nivel:hover {
      transform: scale(1.05);
    }

    /* Carpetas tipo Windows */
    .secciones-conquistadores {
      list-style: none;
      padding-left: 0;
    }

    .seccion-item {
      margin: 6px 0;
    }

    .seccion-titulo {
      display: flex;
      align-items: center;
      padding: 10px;
      background: #f3f3f3;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #ccc;
      transition: background 0.2s;
    }

    .seccion-titulo::before {
      content: "üìÅ";
      margin-right: 8px;
    }

    .seccion-titulo.abierto::before {
      content: "üìÇ";
    }

    .seccion-titulo:hover {
      background: #dce8ff;
    }

    .seccion-contenido {
      padding: 10px 20px;
      margin-top: 4px;
      border-left: 4px solid #1976d2;
      background: #fff;
      border-radius: 0 4px 4px 0;
    }

    /* Estilos para la secci√≥n de certificaciones */
    /* Estilos espec√≠ficos para la secci√≥n de certificaciones */
    .card-certificaciones {
      max-width: none !important;
      width: calc(100% - 20px) !important;
      margin: 10px !important;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
      background: #fff;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card-certificaciones:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
    }

    #certificacionesSection {
      width: 100%;
      padding: 0;
    }

    #certificacionesContadores {
      background: #e8f4fd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }

    #certificacionesContadores p {
      margin: 5px 0;
      font-weight: bold;
      color: #2c3e50;
    }

    #certificacionesContadores span {
      color: #e74c3c;
      font-size: 18px;
    }

    #tablaCertificaciones {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    #tablaCertificaciones thead {
      background: #34495e;
      color: white;
    }

    #tablaCertificaciones th {
      padding: 12px 15px;
      text-align: left;
      font-weight: 600;
    }

    #tablaCertificaciones tbody tr {
      border-bottom: 1px solid #ddd;
      transition: background-color 0.3s ease;
    }

    #tablaCertificaciones tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    #tablaCertificaciones tbody tr:hover {
      background-color: #e8f4fd;
    }

    #tablaCertificaciones td {
      padding: 10px 15px;
      white-space: nowrap;
    }

    /* üîπ CONTENEDOR DE LA TABLA CON SCROLL HORIZONTAL */
#certificacionesContent {
    overflow-x: auto;
    max-width: 100%;
    margin-top: 20px;
}

    .estado-completado {
      color: #27ae60;
      font-weight: bold;
    }

    .estado-pendiente {
      color: #e67e22;
      font-weight: bold;
    }

    .estado-incompleto {
      color: #e74c3c;
      font-weight: bold;
    }

    .calificacion-aprobada {
      color: #27ae60;
      font-weight: bold;
    }

    .calificacion-reprobada {
      color: #e74c3c;
      font-weight: bold;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Header fijo con informaci√≥n del usuario */
    #userHeader {
      position: fixed;
      top: 20px;
      right: 30px;
      display: flex;
      align-items: center;
      gap: 15px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 20px;
      border-radius: 50px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      z-index: 100;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    #userHeader img {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #1976d2;
    }

    #userHeader span {
      font-weight: 600;
      color: #2c3e50;
      font-size: 16px;
    }

    /* Ajustar el contenido principal para el header fijo */
    #mainContent {
      flex: 1;
      padding: 25px;
      overflow-y: auto;
      position: relative;
    }





















    /* ============================================
   RESPONSIVE DESIGN - LAPTOP, TABLET, M√ìVIL
   ============================================ */

/* üîπ LAPTOP (1024px - 1440px) */
@media (max-width: 1440px) {
    #mainContent {
        padding: 20px;
    }
    
    .card {
        max-width: 90%;
        margin: 15px auto;
        padding: 20px;
    }
}

/* üîπ TABLET (768px - 1023px) */
@media (max-width: 1023px) {
    body {
        flex-direction: column;
        height: auto;
        min-height: 100vh;
        padding-top: 120px; /* Espacio para los elementos fijos */
    }

    /* Men√∫ lateral convertido en header fijo */
    #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: auto;
        flex-direction: row;
        overflow-x: auto;
        padding: 10px 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        background: #1565c0;
        justify-content: flex-start;
        align-items: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch; /* Scroll suave en iOS */
    }

    /* Ocultar t√≠tulo del sidebar */
    #sidebar h2 {
        display: none;
    }

    /* Contenedor para los botones del men√∫ (desplazable) */
    #sidebar::before {
        content: '';
        display: flex;
        flex: 1;
        overflow-x: auto;
        gap: 5px;
        padding-right: 10px;
    }

    #sidebar button {
        padding: 10px 15px;
        margin: 0;
        margin-left: 5px;
        margin-right: 5px;
        text-align: center;
        flex-shrink: 0;
        border-radius: 6px;
        font-size: 14px;
        white-space: nowrap;
        transform: none !important; /* Eliminar transformaci√≥n hover */
    }

    #sidebar button:hover {
        transform: none !important;
        background: rgba(255, 255, 255, 0.2);
    }

    /* Bot√≥n de salir fijo a la derecha */
    #sidebar #logoutBtn {
        margin-left: 10px;
        flex-shrink: 0;
        position: sticky;
        right: 0;
        background: #e53935;
    }

    #sidebar #logoutBtn:hover {
        background: #b71c1c;
    }

    #mainContent {
        padding: 15px;
        margin-top: 0;
        width: 100%;
    }

    .card {
        max-width: 95%;
        margin: 10px auto;
        padding: 15px;
    }

    /* Header del usuario fijo */
    #userHeader {
        position: fixed;
        top: 60px; /* Debajo del men√∫ */
        right: 0;
        left: 0;
        margin: 0;
        padding: 10px 15px;
        border-radius: 0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        z-index: 999;
        background: rgba(255, 255, 255, 0.95);
        justify-content: center;
        width: 100%;
    }
}

/* üîπ M√ìVIL GRANDE (576px - 767px) */
@media (max-width: 767px) {
    body {
        padding-top: 110px; /* Ajuste para m√≥vil */
    }

    #sidebar {
        padding: 8px 10px;
    }

    #sidebar button {
        padding: 8px 12px;
        font-size: 13px;
    }

    #userHeader {
        top: 50px; /* Ajuste para m√≥vil */
        padding: 8px 10px;
    }

    #userHeader img {
        width: 35px;
        height: 35px;
    }

    #userHeader span {
        font-size: 14px;
    }

    /* Mejorar scroll del men√∫ */
    #sidebar {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    }

    #sidebar::-webkit-scrollbar {
        height: 4px;
    }

    #sidebar::-webkit-scrollbar-track {
        background: transparent;
    }

    #sidebar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
    }
}

/* üîπ M√ìVIL PEQUE√ëO (375px - 575px) */
@media (max-width: 575px) {
    body {
        padding-top: 100px; /* Ajuste para m√≥vil peque√±o */
    }

    #sidebar {
        padding: 5px 8px;
    }

    #sidebar button {
        padding: 6px 10px;
        font-size: 12px;
    }

    #userHeader {
        top: 40px; /* Ajuste para m√≥vil peque√±o */
        padding: 5px 8px;
    }

    #userHeader img {
        width: 30px;
        height: 30px;
    }

    #userHeader span {
        font-size: 12px;
    }
}

/* üîπ MEJORAS DE SCROLL PARA EL MEN√ö */
@media (max-width: 1023px) {
    #sidebar {
        /* Permitir scroll horizontal */
        overflow-x: auto;
        overflow-y: hidden;
        
        /* Ocultar scrollbar en algunos navegadores */
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }
    
    /* Ocultar scrollbar en Chrome, Safari y Opera */
    #sidebar::-webkit-scrollbar {
        display: none;
    }
    

}
  </style>
</head>

<body>

  <!-- Men√∫ lateral -->
  <div id="sidebar">
    <h2></h2>
    <button id="menuInicio" class="active">Inicio</button>
    <button id="menuClubes">Clubes</button>
    <button id="menuCertificaciones">Certificaciones</button>
    <button id="menuEspecialidades">Especialidades Storage</button>
    <button id="menuPerfil">Perfil</button>
    <button id="logoutBtn">Cerrar sesi√≥n</button>
  </div>

  <!-- Contenido principal -->
  <div id="mainContent">
    <!-- Header fijo con informaci√≥n del usuario -->
    <div id="userHeader">
      <img id="headerUserPhoto" src="https://dummyimage.com/45x45/ccc/fff">
      <span id="headerUserName">Cargando...</span>
    </div>

    <!-- Inicio -->
    <div id="inicioSection" class="card">
      <h2>Bienvenido</h2>
      <p>Selecciona una opci√≥n del men√∫ para comenzar.</p>
    </div>

    <!-- Secci√≥n Clubes -->
    <div id="clubesSection" class="card hidden">
      <h2>Clubes</h2>

      <!-- Botones de clubes -->
      <div id="clubesContainer" style="display:flex; gap:10px; margin-bottom:15px;">
        <button class="clubBtn" data-club="aventureros">Club de Aventureros</button>
        <button class="clubBtn" data-club="conquistadores">Club de Conquistadores</button>
        <button class="clubBtn" data-club="guias">Club de Gu√≠as Mayores</button>
      </div>

      <!-- Panel de contenido de clubes -->
      <div id="clubesPanel">
        <!-- Aqu√≠ se ir√°n agregando las carpetas y secciones din√°micamente -->
      </div>
    </div>



    <!-- Especialidades Storage -->
    <div id="especialidadesSection" class="card hidden">
      <h2>Mi Almacenamiento Leyenda De Especialidades</h2>
      <!--
      <input type="text" id="nombreEspecialidad" placeholder="Nombre de la especialidad">
      <button id="crearEspecialidad">Crear Carpeta</button>-->


      <h4>Carpetas existentes:</h4>
      <ul id="listaEspecialidades"></ul>
      <div id="archivosContainer" class="hidden">
        <h3 id="especialidadActual">Especialidad:</h3>
        <button id="cerrarEspecialidad">Cerrar carpeta</button>
        <input type="file" id="subirArchivo" accept=".pdf, .jpg, .jpeg, .png">
        <button id="subirArchivoBtn">Subir Archivo</button>

        <div>
          <label for="ordenArchivos">Ordenar por:</label>
          <select id="ordenArchivos">
            <option value="nombreDesc">Nombre ‚Üì</option>
            <option value="nombreAsc">Nombre ‚Üë</option>
            <option value="fechaDesc">Fecha ‚Üì</option>
            <option value="fechaAsc">Fecha ‚Üë</option>
            <option value="sizeDesc">Tama√±o ‚Üì</option>
            <option value="sizeAsc">Tama√±o ‚Üë</option>
          </select>
        </div>

        <ul id="listaArchivos"></ul>

      </div>
    </div>

    <!-- Perfil (secci√≥n corregida) -->
    <div id="perfilSection" class="card hidden">
      <h1>Editar Informaci√≥n</h1>
      <form id="editForm">
        <div style="text-align: center; margin-bottom: 20px;">
          <img id="preview" src="https://dummyimage.com/200x200/ccc/fff"
            style="width: 200px; height: 200px; border-radius: 50%; object-fit: cover; border: 3px solid #1976d2;">
        </div>

        <h3>Actualizar Foto:</h3>
        <input type="file" id="foto" accept="image/*">

        <h3>Datos personales:</h3>

        <!-- Correo (solo lectura) -->
        <div style="margin-bottom: 15px;">
          <label for="correo" style="display: block; margin-bottom: 5px; font-weight: bold;">Correo electr√≥nico:</label>
          <input type="email" id="correo" readonly style="background-color: #f5f5f5; color: #666;">
        </div>

        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="text" id="apellido" placeholder="Apellido" required>
        <input type="number" id="edad" placeholder="Edad" required>
        <select id="sexo" required>
          <option value="">Seleccionar sexo</option>
          <option value="Masculino">Masculino</option>
          <option value="Femenino">Femenino</option>
          <option value="Otro">Otro</option>
        </select>
        <input type="text" id="pais" placeholder="Pa√≠s" required>

        <button type="submit" class="saveBtn">Guardar cambios</button>
      </form>
    </div>

    <!-- üîπ NUEVA SECCI√ìN: CERTIFICACIONES -->
    <div id="certificacionesSection" class="hidden">
      <div class="card card-certificaciones">
        <h2>üìú Mis Certificaciones de Especialidades</h2>
        <p>Aqu√≠ puedes ver todas las especialidades en las que has participado, validadas con tu correo electr√≥nico.</p>

        <div id="certificacionesLoading" style="text-align: center; padding: 20px;">
          <div class="loading" style="display: inline-block;"></div>
          <p>Cargando tus certificaciones...</p>
        </div>

        <div id="certificacionesContent" style="display: none;">
          <div id="certificacionesContadores">
            <p>Total de especialidades: <span id="totalEspecialidades">0</span></p>
            <p>Especialidades completadas: <span id="especialidadesCompletadas">0</span></p>
          </div>

          <table id="tablaCertificaciones" border="1" style="border-collapse: collapse; width: 100%; margin-top: 20px;">
            <thead>
              <tr>
                <th>#</th>
                <th>Especialidad</th>
                <th>Fecha de Participaci√≥n</th>
                <th>Asistencias Completadas</th>
                <th>Examen Realizado</th>
                <th>Calificaci√≥n</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody id="cuerpoTablaCertificaciones">
              <!-- Las filas se llenar√°n din√°micamente -->
            </tbody>
          </table>

          <div id="sinCertificaciones" style="display: none; text-align: center; padding: 30px; color: #666;">
            <h3>üìù A√∫n no tienes certificaciones</h3>
            <p>Participa en especialidades para ver tus certificaciones aqu√≠.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- üîπ Visor PDF modal -->
    <div id="pdfViewerModal" class="hidden" style="display: none;">
      <div class="pdf-viewer-content">
        <button id="cerrarPDF" class="cerrar-pdf">‚úñ</button>
        <iframe id="pdfFrame" src="" allowfullscreen style="border:none;"></iframe>
      </div>
    </div>

    <!-- üîπ Contenedor general de mensajes -->
    <div id="mensajeModal" class="hiddenX">
      <div class="mensaje-content">
        <h3 id="mensajeTitulo">T√≠tulo</h3>
        <p id="mensajeTexto">Texto del mensaje</p>
        <div id="mensajeBotones">
          <button id="mensajeAceptar">Aceptar</button>
          <button id="mensajeCancelar" class="hiddenX">Cancelar</button>
        </div>
      </div>
    </div>


    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
      import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
      import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
      import {
        getStorage, ref, uploadBytes, getDownloadURL, deleteObject, listAll, getMetadata
      } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-storage.js";

      const firebaseConfig = {
        apiKey: "AIzaSyB1YTwZM8wKlxZ8HhXb7EUse8YyLmcfeS8",
        authDomain: "conquiguias-world-85ccd.firebaseapp.com",
        projectId: "conquiguias-world-85ccd",
        storageBucket: "conquiguias-world-85ccd.firebasestorage.app",
        messagingSenderId: "785222651205",
        appId: "1:785222651205:web:0486c50e9d8af6bf9b022c"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const storage = getStorage(app);

      // Elementos UI
      const inicioNombre = document.getElementById("inicioNombre");
      const inicioFoto = document.getElementById("inicioFoto");
      const perfilSection = document.getElementById("perfilSection");
      const inicioSection = document.getElementById("inicioSection");
      const especialidadesSection = document.getElementById("especialidadesSection");
      const menuInicio = document.getElementById("menuInicio");
      const menuPerfil = document.getElementById("menuPerfil");
      const menuEspecialidades = document.getElementById("menuEspecialidades");
      const menuCertificaciones = document.getElementById("menuCertificaciones");
      const logoutBtn = document.getElementById("logoutBtn");
      const editForm = document.getElementById("editForm");
      const fotoInput = document.getElementById("foto");
      const preview = document.getElementById("preview");
      const removePhotoBtn = document.getElementById("removePhoto");
      const nombreInput = document.getElementById("nombre");
      const apellidoInput = document.getElementById("apellido");
      const edadInput = document.getElementById("edad");
      const sexoInput = document.getElementById("sexo");
      const paisInput = document.getElementById("pais");
      const listaEspecialidades = document.getElementById("listaEspecialidades");
      const archivosContainer = document.getElementById("archivosContainer");
      const especialidadActualH3 = document.getElementById("especialidadActual");
      const subirArchivoInput = document.getElementById("subirArchivo");
      const subirArchivoBtn = document.getElementById("subirArchivoBtn");
      const listaArchivos = document.getElementById("listaArchivos");
      const cerrarEspecialidadBtn = document.getElementById("cerrarEspecialidad");

      // Elementos de Certificaciones
      const certificacionesSection = document.getElementById("certificacionesSection");
      const certificacionesLoading = document.getElementById("certificacionesLoading");
      const certificacionesContent = document.getElementById("certificacionesContent");
      const sinCertificaciones = document.getElementById("sinCertificaciones");
      const cuerpoTablaCertificaciones = document.getElementById("cuerpoTablaCertificaciones");
      const totalEspecialidades = document.getElementById("totalEspecialidades");
      const especialidadesCompletadas = document.getElementById("especialidadesCompletadas");

      let especialidadSeleccionada = "";
      let currentUserId = null;
      let currentPhotoURL = "";
      const placeholderURL = "https://dummyimage.com/120x120/ccc/fff";

      // Variable global para guardar si el usuario puede acceder o no
      let puedeEntrarEspecialidades = false;

      // üîπ Detectar usuario logueado
      // üîπ Detectar usuario logueado
      onAuthStateChanged(auth, async (user) => {
        // üîí Lista de correos permitidos para entrar a Especialidades
        const correosAutorizados = [
          "kendall.torres.17@gmail.com",
          "lunabecky026@gmail.com"
        ];

        // Obtener elementos del header
        const headerUserPhoto = document.getElementById("headerUserPhoto");
        const headerUserName = document.getElementById("headerUserName");

        // Obtener el campo de correo del perfil
        const correoInput = document.getElementById("correo");

        // Dentro del onAuthStateChanged (despu√©s de obtener el usuario)
        if (user) {
          const email = user.email;
          puedeEntrarEspecialidades = correosAutorizados.includes(email);
        }

        if (!user) {
          window.location.href = "index.html";
          return;
        }

        currentUserId = user.uid;

        const docRef = doc(db, "usuarios", currentUserId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
          currentPhotoURL = data.fotoURL || placeholderURL;

          // Actualizar header del usuario
          headerUserPhoto.src = currentPhotoURL;
          headerUserName.textContent = `${data.nombre || ''} ${data.apellido || ''}`;

          // Actualizar los campos del perfil
          nombreInput.value = data.nombre || '';
          apellidoInput.value = data.apellido || '';
          edadInput.value = data.edad || '';
          sexoInput.value = data.sexo || '';
          paisInput.value = data.pais || '';
          preview.src = currentPhotoURL;

          // Establecer el correo (solo lectura)
          correoInput.value = user.email || '';
        }

        cargarEspecialidadesFijas();
      });

      // üîπ Navegaci√≥n
      menuInicio.addEventListener("click", () => mostrarSeccion(inicioSection, menuInicio));
      menuPerfil.addEventListener("click", () => mostrarSeccion(perfilSection, menuPerfil));
      menuCertificaciones.addEventListener("click", () => {
        mostrarSeccion(certificacionesSection, menuCertificaciones);
        cargarCertificaciones();
      });

      // üîπ Men√∫ Especialidades con bloqueo si no es autorizado
      menuEspecialidades.addEventListener("click", () => {
        if (!puedeEntrarEspecialidades) {
          mostrarMensaje("error", "Acceso restringido", "üö´ Solo personal Premium puede ingresar a esta secci√≥n.");
          return;
        }

        mostrarSeccion(especialidadesSection, menuEspecialidades);
        cargarEspecialidadesFijas();
      });

      // üîπ Foto de perfil
      fotoInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => preview.src = reader.result;
          reader.readAsDataURL(file);
        }
      });

      // üîπ Guardar perfil (versi√≥n con eliminaci√≥n de foto anterior)
      editForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (!currentUserId) return;

        let newPhotoURL = currentPhotoURL;
        const file = fotoInput.files[0];

        try {
          // ‚úÖ Validar tama√±o antes de subir
          if (file && file.size > 1024 * 1024) {
            mostrarMensaje("info", "‚ö†Ô∏è La imagen no debe superar 1 MB.", "");
            return;
          }

          // ‚úÖ Si hay un archivo nuevo, eliminar el anterior
          if (file && currentPhotoURL) {
            try {
              // Buscar y eliminar foto anterior
              const oldRef = ref(storage, currentPhotoURL);
              await deleteObject(oldRef);
              console.log("üóëÔ∏è Foto anterior eliminada del servidor");
            } catch (err) {
              console.warn("‚ö†Ô∏è No se pudo eliminar la foto anterior:", err.message);
            }
          }

          // ‚úÖ Subir la nueva imagen (si existe)
          if (file) {
            const storageRef = ref(storage, `usuarios/${currentUserId}/${file.name}`);
            await uploadBytes(storageRef, file);
            newPhotoURL = await getDownloadURL(storageRef);
          }

          // ‚úÖ Actualizar datos en Firestore
          const docRef = doc(db, "usuarios", currentUserId);
          await updateDoc(docRef, {
            nombre: nombreInput.value,
            apellido: apellidoInput.value,
            edad: edadInput.value,
            sexo: sexoInput.value,
            pais: paisInput.value,
            fotoURL: newPhotoURL
          });

          mostrarMensaje("info", "‚úÖ Informaci√≥n actualizada correctamente.", "", () => {
            window.location.reload();
          });

        } catch (error) {
          console.error(error);
          mostrarMensaje("error", "‚ùå Error al actualizar", "");
        }
      });

      logoutBtn.addEventListener("click", async () => {
        await signOut(auth);
        window.location.href = "index.html";
      });

      ////////////////////////
      // üìÅ ESPECIALIDADES STORAGE
      ////////////////////////
      const especialidadesFijas = ["Especialidades Completadas", "Certificaciones", "Carpeta Gu√≠a Mayor", "Otros"];

      function cargarEspecialidadesFijas() {
        listaEspecialidades.innerHTML = "";
        especialidadesFijas.forEach(nombre => {
          const li = document.createElement("li");
          li.textContent = nombre;
          li.classList.add("carpeta-item");
          listaEspecialidades.appendChild(li);
        });
      }

      listaEspecialidades.addEventListener("click", (e) => {
        if (e.target.tagName !== "LI") return;
        especialidadSeleccionada = e.target.textContent;
        especialidadActualH3.textContent = `üìÇ ${especialidadSeleccionada}`;
        archivosContainer.classList.remove("hidden");
        cargarArchivos(especialidadSeleccionada);
      });

      subirArchivoBtn.addEventListener("click", async () => {
        if (!especialidadSeleccionada || !subirArchivoInput.files[0])
          return mostrarMensaje("info", "Selecciona un archivo v√°lido", "");

        const file = subirArchivoInput.files[0];
        const ext = file.name.split(".").pop().toLowerCase();
        if (!["pdf", "jpg", "jpeg", "png"].includes(ext))
          return mostrarMensaje("error", "‚ùå Solo se permiten archivos PDF o im√°genes (JPG, JPEG, PNG)", "No se aceptan extensiones diferentes que no sean archivos de pdf o im√°genes.");

        const storageRefFile = ref(storage, `usuarios/${currentUserId}/carpetas/${especialidadSeleccionada}/${file.name}`);
        await uploadBytes(storageRefFile, file);
        mostrarMensaje("info", `üìÑ Archivo "${file.name}" subido correctamente`, "");
        subirArchivoInput.value = "";
        cargarArchivos(especialidadSeleccionada);
      });

      async function cargarArchivos(especialidad, orden = "nombreDesc") {
        listaArchivos.innerHTML = "";
        const folderRef = ref(storage, `usuarios/${currentUserId}/carpetas/${especialidad}/`);
        try {
          const result = await listAll(folderRef);
          if (result.items.length === 0) {
            listaArchivos.innerHTML = "<li>No hay archivos a√∫n.</li>";
            return;
          }

          const archivos = [];
          for (const fileRef of result.items) {
            const url = await getDownloadURL(fileRef);
            const meta = await getMetadata(fileRef);

            archivos.push({
              ref: fileRef,
              url,
              nombre: fileRef.name,
              fecha: new Date(meta.timeCreated),
              size: meta.size
            });
          }

          // üîπ Orden seg√∫n selecci√≥n
          switch (orden) {
            case "nombreAsc":
              archivos.sort((a, b) => a.nombre.localeCompare(b.nombre));
              break;
            case "nombreDesc":
              archivos.sort((a, b) => b.nombre.localeCompare(a.nombre));
              break;
            case "fechaAsc":
              archivos.sort((a, b) => a.fecha - b.fecha);
              break;
            case "fechaDesc":
              archivos.sort((a, b) => b.fecha - a.fecha);
              break;
            case "sizeAsc":
              archivos.sort((a, b) => a.size - b.size);
              break;
            case "sizeDesc":
              archivos.sort((a, b) => b.size - a.size);
              break;
          }

          // üîπ Crear elementos en la lista (igual que antes)
          archivos.forEach(file => {
            const li = document.createElement("li");
            li.classList.add("archivo-item");
            li.style.display = "flex";
            li.style.justifyContent = "space-between";
            li.style.alignItems = "center";

            const nombreSpan = document.createElement("span");
            nombreSpan.textContent = file.nombre;
            nombreSpan.classList.add("archivo-link");
            nombreSpan.style.cursor = "pointer";
            nombreSpan.addEventListener("click", () => {
              const ext = file.nombre.split('.').pop().toLowerCase();
              if (ext === "pdf") abrirVisorPDF(file.url);
              else window.open(file.url, "_blank");
            });

            const infoSpan = document.createElement("span");
            infoSpan.textContent = `${file.fecha.toLocaleDateString()} ${file.fecha.toLocaleTimeString()} ‚Ä¢ ${(file.size / 1024).toFixed(2)} KB`;
            infoSpan.style.color = "#555";
            infoSpan.style.fontSize = "13px";

            const eliminarBtn = document.createElement("button");
            eliminarBtn.textContent = "üóëÔ∏è";
            eliminarBtn.classList.add("delete-btn");
            eliminarBtn.addEventListener("click", async () => {
              mostrarMensaje("confirm", "Confirmar eliminaci√≥n", `¬øEliminar "${file.nombre}"?`, async () => {
                await deleteObject(file.ref);
                cargarArchivos(especialidad, orden);
              });

            });

            const infoContainer = document.createElement("div");
            infoContainer.style.display = "flex";
            infoContainer.style.gap = "10px";
            infoContainer.appendChild(infoSpan);
            infoContainer.appendChild(eliminarBtn);

            li.appendChild(nombreSpan);
            li.appendChild(infoContainer);
            listaArchivos.appendChild(li);
          });

        } catch (err) {
          console.error("Error al cargar archivos:", err);
          mostrarMensaje("error", "Error al cargar archivos", "");
        }
      }
      const ordenSelect = document.getElementById("ordenArchivos");

      ordenSelect.addEventListener("change", () => {
        if (especialidadSeleccionada) {
          cargarArchivos(especialidadSeleccionada, ordenSelect.value);
        }
      });

      cerrarEspecialidadBtn.addEventListener("click", () => {
        archivosContainer.classList.add("hidden");
        especialidadSeleccionada = "";
      });

      function mostrarSeccion(seccion, botonActivo) {
        [inicioSection, perfilSection, especialidadesSection, clubesSection, certificacionesSection].forEach(sec => sec.classList.add("hidden"));
        [menuInicio, menuPerfil, menuEspecialidades, menuClubes, menuCertificaciones].forEach(btn => btn.classList.remove("active"));

        seccion.classList.remove("hidden");
        botonActivo.classList.add("active");
      }

      ////////////////////////////////////////////
      // üîπ VISOR PDF
      const pdfViewerModal = document.getElementById("pdfViewerModal");
      const pdfFrame = document.getElementById("pdfFrame");
      const cerrarPDF = document.getElementById("cerrarPDF");

      function abrirVisorPDF(url) {
        pdfFrame.src = url;
        pdfViewerModal.style.display = "flex";
      }

      // üîπ MODIFICAR EL CIERRE DEL MODAL PARA LIMPIAR EL CONTENIDO
      cerrarPDF.addEventListener('click', () => {
        pdfViewerModal.style.display = "none";
        pdfFrame.src = "";

        // Ocultar y limpiar el contenedor de certificaci√≥n
        const certContainer = document.getElementById('certificacionContainer');
        if (certContainer) {
          certContainer.style.display = 'none';
          certContainer.innerHTML = '';
        }

        // Mostrar el iframe nuevamente
        pdfFrame.style.display = 'block';
      });

      pdfViewerModal.addEventListener('click', (e) => {
        if (e.target === pdfViewerModal) {
          pdfViewerModal.style.display = "none";
          pdfFrame.src = "";

          // Ocultar y limpiar el contenedor de certificaci√≥n
          const certContainer = document.getElementById('certificacionContainer');
          if (certContainer) {
            certContainer.style.display = 'none';
            certContainer.innerHTML = '';
          }

          // Mostrar el iframe nuevamente
          pdfFrame.style.display = 'block';
        }
      });

      ////////////////////////////////////////
      /**
       * üîπ Mostrar mensaje din√°mico
       * @param {string} tipo - "info" | "error" | "confirm"
       * @param {string} titulo - Texto del t√≠tulo
       * @param {string} mensaje - Texto del cuerpo
       * @param {function} onConfirm - (Opcional) callback si se presiona "Aceptar" en tipo confirm
       */
      function mostrarMensaje(tipo, titulo, mensaje, onConfirm = null) {
        const modal = document.getElementById("mensajeModal");
        const tituloEl = document.getElementById("mensajeTitulo");
        const textoEl = document.getElementById("mensajeTexto");
        const btnAceptar = document.getElementById("mensajeAceptar");
        const btnCancelar = document.getElementById("mensajeCancelar");

        tituloEl.textContent = titulo;
        textoEl.textContent = mensaje;
        modal.classList.remove("hiddenX");

        // Configurar botones
        btnCancelar.classList.toggle("hiddenX", tipo !== "confirm");

        const cerrar = () => {
          modal.classList.add("hiddenX");
          btnAceptar.onclick = null;
          btnCancelar.onclick = null;
        };

        btnAceptar.onclick = () => {
          cerrar();
          if (onConfirm && (tipo === "confirm" || tipo === "info")) onConfirm();
        };

        btnCancelar.onclick = cerrar;
      }

      ////////////////////////////////////////////
      const menuClubes = document.getElementById("menuClubes");
      const clubesSection = document.getElementById("clubesSection");

      menuClubes.addEventListener("click", () => {
        mostrarSeccion(clubesSection, menuClubes);
      });
      ///////////////////////////////////////////

      const clubBtns = document.querySelectorAll(".clubBtn");
      const clubesPanel = document.getElementById("clubesPanel");

      // Datos de cada club
      const clubesData = {
        aventureros: {
          niveles: ["Amigo", "Compa√±ero", "Explorador"],
          carpetas: ["Voto y Ley", "Bandera de Aventureros", "Himno del Club"]
        },
        conquistadores: {
          niveles: ["Amigo", "Compa√±ero", "Explorador", "Orientador", "Viajero", "Gu√≠a"],
          carpetas: [
            "Voto y Ley",
            "Especialidades Ja",
            "Bandera de Conquistadores",
            "Himno del Conquistador",
            "Manual de Nudos",
            "Formularios y Permisos",
            "Manual del Uniforme",
            "Uso del Hacha y Cuchillo",
            "Registros",
            "Gu√≠a para el Director",
            "Gu√≠a R√°pida para el Director del Club de Conquistadores",
            "Logos e Im√°genes",
            "Lista de Especialidades para Cada Nivel Progresivo"
          ]
        },
        guias: {
          niveles: ["Explorador", "Gu√≠a", "Coordinador"],
          carpetas: ["Voto y Ley", "Manual de Gu√≠as", "Registros"]
        }
      };

      // Click en club
      clubBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          const clubKey = btn.dataset.club;

          // Limpiar panel
          clubesPanel.innerHTML = "";

          const clubData = clubesData[clubKey] || { niveles: [], carpetas: [] };

          const clubContainer = document.createElement("div");
          clubContainer.dataset.panel = clubKey;

          // üîπ Niveles
          if (clubData.niveles.length > 0) {
            const nivelesContainer = document.createElement("div");
            nivelesContainer.style.display = "grid";
            nivelesContainer.style.gridTemplateColumns = "repeat(3, 1fr)";
            nivelesContainer.style.gap = "10px";
            nivelesContainer.style.marginBottom = "15px";

            const nivelesContenidoContainer = document.createElement("div");

            clubData.niveles.forEach(nivel => {
              const btnNivel = document.createElement("div");
              btnNivel.classList.add("carpeta-item");
              btnNivel.textContent = nivel;

              const contenido = document.createElement("div");
              contenido.classList.add("hidden");
              contenido.style.marginTop = "5px";
              contenido.textContent = "Contenido de " + nivel;

              btnNivel.addEventListener("click", () => {
                contenido.classList.toggle("hidden");
              });

              nivelesContainer.appendChild(btnNivel);
              nivelesContenidoContainer.appendChild(contenido);
            });

            clubContainer.appendChild(nivelesContainer);
            clubContainer.appendChild(nivelesContenidoContainer);
          }

          // üîπ Carpetas
          if (clubData.carpetas.length > 0) {
            const carpetasContainer = document.createElement("div");
            clubData.carpetas.forEach(carpetaName => {
              const carpeta = document.createElement("div");
              carpeta.classList.add("carpeta-item");
              carpeta.textContent = carpetaName;

              const contenido = document.createElement("div");
              contenido.classList.add("hidden");
              contenido.style.marginLeft = "20px";
              contenido.style.marginBottom = "5px";

              const archivo = document.createElement("div");
              archivo.textContent = "Contenido de " + carpetaName;
              contenido.appendChild(archivo);

              carpeta.addEventListener("click", () => {
                contenido.classList.toggle("hidden");
              });

              carpetasContainer.appendChild(carpeta);
              carpetasContainer.appendChild(contenido);
            });

            clubContainer.appendChild(carpetasContainer);
          }

          clubesPanel.appendChild(clubContainer);
        });
      });

      // üîπ NUEVAS FUNCIONES PARA CERTIFICACIONES - DENTRO DEL M√ìDULO

      // Funci√≥n para cargar las certificaciones del usuario
      // Funci√≥n para cargar las certificaciones del usuario
      // üîπ NUEVAS FUNCIONES PARA CERTIFICACIONES - DENTRO DEL M√ìDULO

      // Funci√≥n para cargar las certificaciones del usuario
      // üîπ NUEVAS FUNCIONES PARA CERTIFICACIONES - DENTRO DEL M√ìDULO

      // Funci√≥n para cargar las certificaciones del usuario
      async function cargarCertificaciones() {
        // Mostrar loading
        certificacionesLoading.style.display = "block";
        certificacionesContent.style.display = "none";
        sinCertificaciones.style.display = "none";

        try {
          // Obtener el usuario actual
          const user = auth.currentUser;
          if (!user || !user.email) {
            throw new Error("No se pudo obtener la informaci√≥n del usuario");
          }

          const userEmail = user.email;

          // Obtener el visitanteId del localStorage (si existe)
          let visitanteId = localStorage.getItem("visitanteId");

          // Obtener todos los formularios
          const formulariosRes = await fetch("/api/listarFormularios");
          if (!formulariosRes.ok) {
            throw new Error("No se pudieron cargar los formularios");
          }

          const formularios = await formulariosRes.json();
          const formulariosIds = Object.keys(formularios);

          // Array para almacenar las certificaciones
          const certificaciones = [];

          // Para cada formulario, buscar si el usuario particip√≥
          for (const formularioId of formulariosIds) {
            try {
              const respuestasRes = await fetch(`/api/verRespuestas?id=${formularioId}`);
              if (respuestasRes.ok) {
                const data = await respuestasRes.json();
                const respuestas = data.asistencias || [];
                const examenes = data.examenes || [];

                // Obtener la fecha de cierre del formulario desde la lista de formularios
                const fechaCierreFormulario = formularios[formularioId].fechaCierre;
                const fechaFin = fechaCierreFormulario ? new Date(fechaCierreFormulario) : null;
                const hoy = new Date();

                // Buscar TODAS las respuestas del usuario por correo O por visitanteId
                let respuestasUsuario = respuestas.filter(r =>
                  r.correo === userEmail || r.visitanteId === visitanteId
                );

                // Si no encontramos respuestas, continuar con el siguiente formulario
                if (respuestasUsuario.length === 0) {
                  continue;
                }

                // Agrupar respuestas por visitanteId para evitar duplicados
                const respuestasAgrupadas = {};
                respuestasUsuario.forEach(respuesta => {
                  const key = respuesta.visitanteId;
                  if (!respuestasAgrupadas[key]) {
                    respuestasAgrupadas[key] = [];
                  }
                  respuestasAgrupadas[key].push(respuesta);
                });

                // Procesar cada grupo de respuestas (por visitanteId)
                for (const [visitanteIdGrupo, respuestasGrupo] of Object.entries(respuestasAgrupadas)) {
                  // Encontrar el examen del usuario para este visitanteId
                  const examenUsuario = examenes.find(e => e.visitanteId === visitanteIdGrupo);

                  // üîπ CORRECCI√ìN: Contar asistencias completadas correctamente
                  const numerosAsistencia = respuestasGrupo.map(r => r.asistenciaNumero);
                  const asistenciasCompletadas = [1, 2, 3].filter(num =>
                    numerosAsistencia.includes(num)
                  ).length;

                  const examenRealizado = examenUsuario !== undefined;
                  const calificacion = examenRealizado ? examenUsuario.puntaje : null;
                  const aprobado = examenRealizado ? calificacion >= 70 : false;

                  // üîπ NUEVA L√ìGICA PARA DETERMINAR ESTADO
                  let estado = "";
                  let estadoClase = "";

                  if (fechaFin && hoy > fechaFin) {
                    // TIEMPO TERMINADO
                    if (asistenciasCompletadas >= 3) {
                      if (examenRealizado && aprobado) {
                        estado = "Completado";
                        estadoClase = "estado-completado";
                      } else {
                        estado = "Incompleto";
                        estadoClase = "estado-incompleto";
                      }
                    } else {
                      estado = "No aplica";
                      estadoClase = "estado-incompleto";
                    }
                  } else {
                    // TIEMPO EN CURSO
                    if (asistenciasCompletadas >= 3) {
                      if (examenRealizado && aprobado) {
                        estado = "Completado";
                        estadoClase = "estado-completado";
                      } else {
                        estado = "En progreso";
                        estadoClase = "estado-pendiente";
                      }
                    } else {
                      estado = "En progreso";
                      estadoClase = "estado-pendiente";
                    }
                  }

                  // Obtener la fecha m√°s reciente
                  const fechaMasReciente = new Date(Math.max(...respuestasGrupo.map(r => new Date(r.fecha))));

                  certificaciones.push({
                    formularioId: formularioId,
                    titulo: formularios[formularioId].titulo,
                    fecha: fechaMasReciente,
                    asistenciasCompletadas: asistenciasCompletadas,
                    examenRealizado: examenRealizado,
                    calificacion: calificacion,
                    aprobado: aprobado,
                    estado: estado,
                    estadoClase: estadoClase,
                    fechaFin: fechaFin,
                    visitanteId: visitanteIdGrupo
                  });
                }
              }
            } catch (error) {
              console.error(`Error al cargar respuestas para ${formularioId}:`, error);
            }
          }

          // Actualizar la interfaz con las certificaciones
          actualizarInterfazCertificaciones(certificaciones);

        } catch (error) {
          console.error("Error al cargar certificaciones:", error);
          mostrarMensaje("error", "Error al cargar certificaciones", "No se pudieron cargar tus certificaciones. Intenta nuevamente.");

          // Mostrar estado de error
          certificacionesLoading.style.display = "none";
          sinCertificaciones.style.display = "block";
          sinCertificaciones.innerHTML = `
            <h3>‚ùå Error al cargar certificaciones</h3>
            <p>No se pudieron cargar tus certificaciones. Intenta nuevamente.</p>
        `;
        }
      }






      // üîπ AGREGAR FUNCIONES AL WINDOW PARA QUE SEAN GLOBALES
      window.verCertificacionCompleta = verCertificacionCompleta;
      window.imprimirExamenCompleto = imprimirExamenCompleto;
      window.mostrarCertificacionCompleta = mostrarCertificacionCompleta;
      window.extraerNombreFirma = extraerNombreFirma;

      // üîπ FUNCIONES PARA CERTIFICACI√ìN COMPLETA
      async function verCertificacionCompleta(formularioId, visitanteId) {
        try {
          // Obtener la evaluaci√≥n (preguntas)
          const resExamen = await fetch(`/api/obtenerEvaluacion?id=${formularioId}`);
          if (!resExamen.ok) {
            throw new Error('No se pudo cargar la evaluaci√≥n');
          }
          const examen = await resExamen.json();

          // Obtener el resultado del examen
          const resResultados = await fetch(`/api/verRespuestas?id=${formularioId}`);
          if (!resResultados.ok) {
            throw new Error('No se pudo cargar los resultados');
          }
          const data = await resResultados.json();
          const resultadosExamen = data.examenes || [];
          const resultado = resultadosExamen.find(e => e.visitanteId === visitanteId);

          if (!resultado) {
            mostrarMensaje("error", "Error", "No se encontraron resultados para este examen.");
            return;
          }

          // Obtener informaci√≥n del formulario para el t√≠tulo
          const resFormulario = await fetch(`/api/obtenerFormulario?id=${formularioId}`);
          if (!resFormulario.ok) {
            throw new Error('No se pudo cargar la informaci√≥n del formulario');
          }
          const formulario = await resFormulario.json();

          // Mostrar en el modal extendido
          mostrarCertificacionCompleta(examen, resultado, formulario);

        } catch (error) {
          console.error('Error al cargar certificaci√≥n completa:', error);
          mostrarMensaje("error", "Error", "No se pudo cargar la certificaci√≥n: " + error.message);
        }
      }

      function mostrarCertificacionCompleta(examen, resultado, formulario) {
        // Usar el modal del visor PDF pero con contenido personalizado
        const modal = document.getElementById('pdfViewerModal');
        const pdfFrame = document.getElementById('pdfFrame');

        // Ocultar el iframe y mostrar nuestro contenido personalizado
        pdfFrame.style.display = 'none';

        // Crear contenedor para la certificaci√≥n si no existe
        let certContainer = modal.querySelector('#certificacionContainer');
        if (!certContainer) {
          certContainer = document.createElement('div');
          certContainer.id = 'certificacionContainer';
          certContainer.style.cssText = `
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
            background: white;
        `;
          modal.querySelector('.pdf-viewer-content').appendChild(certContainer);
        }

        certContainer.style.display = 'block';

        // Generar el contenido de la certificaci√≥n
        const respuestasUsuario = resultado.respuestas || {};
        let correctas = 0;
        let total = examen.length;

        // Calcular estad√≠sticas
        examen.forEach(pregunta => {
          const respuestaUsuario = respuestasUsuario[pregunta.id];
          const respuestaCorrecta = pregunta.options.find(opt => opt.correct);
          if (respuestaCorrecta && respuestaUsuario === respuestaCorrecta.id) {
            correctas++;
          }
        });

        // Calcular si aprob√≥
        const porcentaje = (correctas / total) * 100;
        const aprobado = porcentaje >= 70;

        let contenidoHTML = `
        <div style="max-width: 800px; margin: 0 auto; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
            <!-- Encabezado -->
            <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #2c3e50; padding-bottom: 20px;">
                <h1 style="color: #2c3e50; margin-bottom: 10px; font-size: 36px;">Conquiguias World</h1>
                <h2 style="color: #34495e; margin-bottom: 20px;">${formulario.titulo}</h2>
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px;">
                    <h3 style="margin: 0 0 10px 0;">Resultados del Examen</h3>
                    <p style="margin: 5px 0; font-size: 18px;">
                        <strong>Resumen:</strong> ${correctas} de ${total} preguntas correctas (${porcentaje.toFixed(1)}%)
                    </p>
                    <p style="margin: 5px 0; font-size: 16px;">
                        <strong>Estado:</strong> ${porcentaje >= 70 ? '‚úÖ Aprobado' : '‚ùå Reprobado'}
                    </p>
                </div>
            </div>

            <!-- Preguntas y respuestas -->
            <div style="margin-bottom: 30px;">
    `;

        // Agregar cada pregunta con retroalimentaci√≥n
        examen.forEach((pregunta, index) => {
          const respuestaUsuario = respuestasUsuario[pregunta.id];
          const respuestaCorrecta = pregunta.options.find(opt => opt.correct);
          const opcionUsuario = pregunta.options.find(opt => opt.id === respuestaUsuario);
          const esCorrecta = respuestaCorrecta && respuestaUsuario === respuestaCorrecta.id;

          contenidoHTML += `
            <div style="margin-bottom: 25px; padding: 20px; border: 2px solid ${esCorrecta ? '#28a745' : '#dc3545'}; border-radius: 10px; background: #f8f9fa;">
                <p style="margin: 0 0 15px 0; font-weight: bold; color: #2c3e50; font-size: 16px;">
                    Pregunta ${index + 1}: ${pregunta.text}
                </p>
                <p style="margin: 0 0 10px 0; color: ${esCorrecta ? '#28a745' : '#dc3545'}; font-weight: bold;">
                    ${esCorrecta ? '‚úÖ Correcta' : '‚ùå Incorrecta'}
                </p>
                <p style="margin: 0 0 8px 0; font-size: 14px;">
                    <strong>Tu respuesta:</strong> ${opcionUsuario ? opcionUsuario.text : 'No respondida'}
                </p>
                ${!esCorrecta && respuestaCorrecta ? `
                    <p style="margin: 0 0 5px 0; font-size: 14px; color: #28a745;">
                        <strong>Respuesta correcta:</strong> ${respuestaCorrecta.text}
                    </p>
                ` : ''}
            </div>
        `;
        });

        contenidoHTML += `
            </div>

            <!-- Botones de acci√≥n -->
            <div style="margin-top: 30px; text-align: center; padding: 20px; background: #ecf0f1; border-radius: 10px;">
        `;

        // Mostrar bot√≥n de impresi√≥n SOLO si aprob√≥
        if (aprobado) {
          contenidoHTML += `
                <button id="btnImprimirExamen" style="
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    padding: 12px 25px;
                    font-size: 16px;
                    font-weight: bold;
                    border-radius: 6px;
                    cursor: pointer;
                    margin: 0 10px;
                ">üñ®Ô∏è Imprimir Examen y Certificaci√≥n</button>
            `;
        } else {
          contenidoHTML += `
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                    <p style="margin: 0; color: #856404; font-size: 14px;">
                        ‚ö†Ô∏è <strong>No aprobado:</strong> Has completado el examen pero no alcanzaste la calificaci√≥n m√≠nima para obtener el certificado.
                    </p>
                </div>
            `;
        }

        

        certContainer.innerHTML = contenidoHTML;
        modal.style.display = 'flex';

        // Configurar event listeners para los botones SOLO si aprob√≥
        if (aprobado) {
          document.getElementById('btnImprimirExamen').addEventListener('click', () => {
            imprimirExamenCompleto(examen, resultado, formulario);
          });
          
        }

      }

      function imprimirExamenCompleto(examen, resultado, formulario) {
        const btnImprimir = document.getElementById('btnImprimirExamen');
        const textoOriginal = btnImprimir.innerHTML;

        // Mostrar loading
        btnImprimir.innerHTML = '‚è≥ Generando PDF...';
        btnImprimir.disabled = true;

        // Obtener el nombre del usuario desde las asistencias
        fetch(`/api/verRespuestas?id=${formulario.id}`)
          .then(res => res.json())
          .then(data => {
            const asistencias = data.asistencias || [];
            // Buscar CUALQUIER asistencia del usuario para obtener su nombre
            const asistenciaUsuario = asistencias.find(a =>
              a.visitanteId === resultado.visitanteId && a.nombre && a.nombre.trim() !== ''
            );

            let nombreUsuario = 'Nombre no encontrado';
            if (asistenciaUsuario && asistenciaUsuario.nombre) {
              nombreUsuario = asistenciaUsuario.nombre.trim();
            } else {
              // Si no se encuentra en asistencias, intentar obtener del perfil del usuario
              const user = auth.currentUser;
              if (user && user.displayName) {
                nombreUsuario = user.displayName;
              } else {
                // √öltimo recurso: usar el correo sin el dominio
                const email = user.email;
                if (email) {
                  nombreUsuario = email.split('@')[0];
                  nombreUsuario = nombreUsuario.split('.').map(word =>
                    word.charAt(0).toUpperCase() + word.slice(1)
                  ).join(' ');
                }
              }
            }

            // Crear ventana de impresi√≥n
            const ventanaImpresion = window.open('', '_blank');
            const respuestasUsuario = resultado.respuestas || {};

            // Calcular estad√≠sticas del examen
            let correctas = 0;
            let total = examen.length;

            examen.forEach(pregunta => {
              const respuestaUsuario = respuestasUsuario[pregunta.id];
              const respuestaCorrecta = pregunta.options.find(opt => opt.correct);
              if (respuestaCorrecta && respuestaUsuario === respuestaCorrecta.id) {
                correctas++;
              }
            });

            const porcentaje = (correctas / total) * 100;
            const aprobado = porcentaje >= 70;

            // Formatear fecha
            const fechaCreacion = new Date(formulario.creado);
            const opcionesFecha = { year: 'numeric', month: 'long', day: 'numeric' };
            const fechaFormateada = fechaCreacion.toLocaleDateString('es-ES', opcionesFecha);

            let contenidoImpresion = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Examen y Certificaci√≥n - ${formulario.titulo}</title>
                    <style>
                        /* ESTILOS PARA EL EXAMEN */
                        .examen-section {
                            margin: 20px;
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        }
                        .header-examen {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #2c3e50;
                            padding-bottom: 20px;
                            position: relative;
                        }
                        .imagen-especialidad-examen {
                            position: absolute;
                            top: 10px;
                            right: 10px;
                            max-width: 80px;
                            max-height: 80px;
                        }
                            .resumen-examen {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            padding: 25px;
                            border-radius: 12px;
                            margin-bottom: 30px;
                            text-align: center;
                        }
                        .pregunta {
                            margin-bottom: 20px;
                            padding: 15px;
                            border-left: 4px solid #3498db;
                            background: #f8f9fa;
                            page-break-inside: avoid;
                        }
                        .correcta { border-left-color: #28a745; }
                        .incorrecta { border-left-color: #dc3545; }
                        
                        /* ESTILOS PARA EL CERTIFICADO (HOJA COMPLETA SEPARADA) */
                        .certificacion-page {
                            page-break-before: always;
                            width: 100%;
                            min-height: 100vh;
                            margin: 0;
                            padding: 40px;
                            display: flex;
                            flex-direction: column;
                            justify-content: center;
                            align-items: center;
                            position: relative;
                            box-sizing: border-box;
                        }
                        .imagen-especialidad-certificado {
                            position: absolute;
                            top: 150px;
                            right: 20px;
                            max-width: 150px;
                            max-height: 150px;
                        }
                        .certificacion-contenido {
                            text-align: center;
                            width: 100%;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        .certificacion-header {
                            margin-bottom: 40px;
                        }
                        .certificacion-titulo {
                            font-size: 14px;
                            margin-bottom: 10px;
                            letter-spacing: 1px;
                        }
                        .certificado-texto {
                            font-size: 48px;
                            color: #2c3e50;
                            font-weight: bold;
                            margin: 20px 0;
                            text-transform: uppercase;
                        }
                        .otorgado-a {
                            font-size: 18px;
                            margin-bottom: 20px;
                            font-weight: bold;
                        }
                        .nombre-usuario {
                            font-size: 32px;
                            font-weight: bold;
                            margin: 30px 0;
                            padding: 20px;
                            border-bottom: 3px solid #2c3e50;
                            display: inline-block;
                            min-width: 400px;
                            max-width: 600px;
                            word-wrap: break-word;
                        }
                        .linea-separadora {
                            width: 400px;
                            border-top: 2px solid #2c3e50;
                            margin: 30px auto;
                        }
                        .texto-certificacion {
                            font-size: 20px;
                            line-height: 1.8;
                            margin: 40px 0;
                            max-width: 600px;
                            margin-left: auto;
                            margin-right: auto;
                        }
                        .firmas-container {
                            margin-top: 80px;
                            display: flex;
                            justify-content: space-around;
                            align-items: flex-start;
                            flex-wrap: nowrap;
                            width: 100%;
                        }
                        .firma {
                            text-align: center;
                            margin: 10px 20px;
                            min-width: 100px;
                            width: 100%;
                        }
                        .firma img {
                            max-width: 140px;
                            max-height: 80px;
                            margin-bottom: 10px;
                        }
                        .linea-firma {
                            width: 180px;
                            border-top: 1px solid #2c3e50;
                            margin: 5px auto;
                        }
                        .nombre-firma {
                            font-weight: bold;
                            font-size: 16px;
                            margin-top: 8px;
                        }
                        .cargo-firma {
                            font-size: 14px;
                            color: #666;
                            margin-top: 5px;
                        }
                        
                        /* ESTILOS GENERALES DE IMPRESI√ìN */
                        @media print {
                            body {
                                margin: 0;
                                padding: 0;
                            }
                            .examen-section {
                                margin: 15px;
                            }
                            .certificacion-page {
                                margin: 0;
                                padding: 50px;
                                border: none;
                            }
                            .no-print {
                                display: none !important;
                            }
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            margin: 0;
                            padding: 0;
                            color: #333;
                        }
                    </style>
                </head>
                <body>
                    <!-- SECCI√ìN DEL EXAMEN -->
                    <div class="examen-section">
                        <div class="header-examen">
                            <h1 style="color: #2c3e50; margin-bottom: 10px; font-size: 28px;">Conquiguias World</h1>
                            <h2 style="color: #34495e; margin-bottom: 10px; font-size: 22px;">${formulario.titulo}</h2>
                            ${formulario.imagenEspecialidad ?
                `<img src="${formulario.imagenEspecialidad}" class="imagen-especialidad-examen" alt="Especialidad">`
                : ''
              }
                        </div>

                        <!-- RESUMEN DEL EXAMEN -->
                        <div class="resumen-examen">
                            <h2 style="margin: 0 0 15px 0; font-size: 24px;">üìä Resultados del Examen</h2>
                            <p style="margin: 8px 0; font-size: 18px;">
                                <strong>Resumen:</strong> ${correctas} de ${total} preguntas correctas (${porcentaje.toFixed(1)}%)
                            </p>
                            <p style="margin: 8px 0; font-size: 18px;">
                                <strong>Estado:</strong> ${aprobado ? '‚úÖ Aprobado' : '‚ùå Reprobado'}
                            </p>
                            ${aprobado ?
                '<p style="margin: 15px 0 0 0; font-size: 16px; font-weight: bold;">üéâ ¬°Felicidades! Has aprobado el examen.</p>' :
                '<p style="margin: 15px 0 0 0; font-size: 16px;">üí° Sigue estudiando para mejorar tus resultados.</p>'
              }
                        </div>

                        <div style="margin: 30px 0; border-top: 2px dashed #ccc; padding-top: 20px;">
                            <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">üìù Detalle de Preguntas</h3>
            `;

            // Agregar preguntas del examen
            examen.forEach((pregunta, index) => {
              const respuestaUsuario = respuestasUsuario[pregunta.id];
              const respuestaCorrecta = pregunta.options.find(opt => opt.correct);
              const opcionUsuario = pregunta.options.find(opt => opt.id === respuestaUsuario);
              const esCorrecta = respuestaCorrecta && respuestaUsuario === respuestaCorrecta.id;

              contenidoImpresion += `
                    <div class="pregunta ${esCorrecta ? 'correcta' : 'incorrecta'}">
                        <p style="margin: 0 0 10px 0; font-weight: bold; font-size: 16px; color: #2c3e50;">
                            <strong>Pregunta ${index + 1}:</strong> ${pregunta.text}
                        </p>
                        <p style="margin: 0 0 8px 0; font-size: 14px; color: ${esCorrecta ? '#28a745' : '#dc3545'}; font-weight: bold;">
                            ${esCorrecta ? '‚úÖ Correcta' : '‚ùå Incorrecta'}
                        </p>
                        <p style="margin: 0 0 8px 0; font-size: 14px;">
                            <strong>Tu respuesta:</strong> ${opcionUsuario ? opcionUsuario.text : 'No respondida'}
                        </p>
                        ${!esCorrecta && respuestaCorrecta ?
                  `<p style="margin: 0 0 5px 0; font-size: 14px; color: #28a745;">
                                <strong>Respuesta correcta:</strong> ${respuestaCorrecta.text}
                            </p>` : ''}
                    </div>
                `;
            });

            // SECCI√ìN DEL CERTIFICADO (HOJA COMPLETA SEPARADA)
            contenidoImpresion += `
                        </div>
                    </div> <!-- Cierre de examen-section -->

                    <!-- CERTIFICADO - HOJA COMPLETA SEPARADA -->
                    <div class="certificacion-page">
                        ${formulario.imagenEspecialidad ?
                `<img src="${formulario.imagenEspecialidad}" class="imagen-especialidad-certificado" alt="Especialidad">`
                : ''
              }
                        
                        <div class="certificacion-contenido">
                            <div class="certificacion-header">
                                <p class="certificacion-titulo">
                                    LA ACADEMIA Y PLATAFORMA ONLINE CONQUIGUIAS WORLD EXTIENDE EL SIGUIENTE
                                </p>
                                <h1 class="certificado-texto">CERTIFICADO</h1>
                            </div>

                            <div class="certificacion-cuerpo">
                                <p class="otorgado-a">OTORGADO A:</p>
                                
                                <div class="nombre-usuario">${nombreUsuario}</div>
                                
                                <!-- <div class="linea-separadora"></div> -->

                                <div class="texto-certificacion">
                                    Por haber participado en la especialidad:<br>
                                    <strong style="color: #2c3e50; font-size: 22px;">"${formulario.titulo}"</strong><br>
                                    impartido por <strong>${extraerNombreFirma(formulario.imagenFirma1) || 'el instructor'}</strong>,<br>
                                    el ${fechaFormateada}.
                                </div>
                            </div>

                            <div class="firmas-container">
                                ${formulario.imagenFirma1 ? `
                                    <div class="firma">
                                        <img src="${formulario.imagenFirma1}" alt="Firma Instructor">
                                        <div class="linea-firma"></div>
                                        <div class="nombre-firma">${extraerNombreFirma(formulario.imagenFirma1)}</div>
                                        <div class="cargo-firma"><strong>INSTRUCTOR</strong></div>
                                    </div>
                                ` : ''}
                                
                                ${formulario.imagenFirma2 ? `
                                    <div class="firma">
                                        <img src="${formulario.imagenFirma2}" alt="Firma Director">
                                        <div class="linea-firma"></div>
                                        <div class="nombre-firma">${extraerNombreFirma(formulario.imagenFirma2)}</div>
                                    </div>
                                ` : ''}
                                
                                ${formulario.imagenFirma3 ? `
                                    <div class="firma">
                                        <img src="${formulario.imagenFirma3}" alt="Firma Coordinador">
                                        <div class="linea-firma"></div>
                                        <div class="nombre-firma">${extraerNombreFirma(formulario.imagenFirma3)}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>

                    <div class="no-print" style="text-align: center; margin: 30px; padding: 20px;">
                        <button onclick="window.print()" style="
                            padding: 12px 25px; 
                            background: #007bff; 
                            color: white; 
                            border: none; 
                            border-radius: 5px; 
                            cursor: pointer;
                            font-size: 16px;
                            margin: 0 10px;
                        ">
                            üñ®Ô∏è Imprimir Documento Completo
                        </button>
                        <button onclick="window.close()" style="
                            padding: 12px 25px; 
                            background: #6c757d; 
                            color: white; 
                            border: none; 
                            border-radius: 5px; 
                            cursor: pointer;
                            font-size: 16px;
                            margin: 0 10px;
                        ">
                            Cerrar Ventana
                        </button>
                    </div>
                </body>
                </html>
            `;

            ventanaImpresion.document.write(contenidoImpresion);
            ventanaImpresion.document.close();

            // Restaurar bot√≥n
            btnImprimir.innerHTML = textoOriginal;
            btnImprimir.disabled = false;
          })
          .catch(error => {
            console.error('Error al obtener asistencias:', error);
            // Restaurar bot√≥n en caso de error
            btnImprimir.innerHTML = textoOriginal;
            btnImprimir.disabled = false;
            mostrarMensaje("error", "Error", "No se pudo generar el PDF: " + error.message);
          });
      }

      // Funci√≥n auxiliar para extraer nombres de las firmas desde la URL
      function extraerNombreFirma(urlFirma) {
        if (!urlFirma) return '';
        // Extraer el nombre del archivo de la URL
        const nombreArchivo = urlFirma.split('/').pop();
        // Remover la extensi√≥n del archivo y cualquier par√°metro
        const nombre = nombreArchivo.split('.')[0];
        // Convertir a formato legible (reemplazar guiones y capitalizar)
        return nombre
          .split('-')
          .map(palabra => palabra.charAt(0).toUpperCase() + palabra.slice(1))
          .join(' ');
      }




      // Funci√≥n para actualizar la interfaz con las certificaciones
      // Funci√≥n para actualizar la interfaz con las certificaciones
      function actualizarInterfazCertificaciones(certificaciones) {
        // Ocultar loading
        certificacionesLoading.style.display = "none";

        if (certificaciones.length === 0) {
          sinCertificaciones.style.display = "block";
          certificacionesContent.style.display = "none";
          return;
        }

        // Mostrar contenido
        sinCertificaciones.style.display = "none";
        certificacionesContent.style.display = "block";

        // Agrupar certificaciones por formularioId para evitar duplicados
        const certificacionesAgrupadas = {};
        certificaciones.forEach(cert => {
          if (!certificacionesAgrupadas[cert.formularioId]) {
            certificacionesAgrupadas[cert.formularioId] = [];
          }
          certificacionesAgrupadas[cert.formularioId].push(cert);
        });

        // Tomar la mejor certificaci√≥n de cada formulario (la que tenga m√°s asistencias completadas)
        const certificacionesUnicas = [];
        Object.values(certificacionesAgrupadas).forEach(grupo => {
          // Ordenar por asistencias completadas (mayor a menor) y luego por fecha (m√°s reciente primero)
          grupo.sort((a, b) => {
            if (b.asistenciasCompletadas !== a.asistenciasCompletadas) {
              return b.asistenciasCompletadas - a.asistenciasCompletadas;
            }
            return new Date(b.fecha) - new Date(a.fecha);
          });
          // Tomar la primera (mejor) certificaci√≥n del grupo
          certificacionesUnicas.push(grupo[0]);
        });

        // Actualizar contadores
        const completadas = certificacionesUnicas.filter(c => c.estado === "Completado").length;
        totalEspecialidades.textContent = certificacionesUnicas.length;
        especialidadesCompletadas.textContent = completadas;

        // Limpiar tabla
        cuerpoTablaCertificaciones.innerHTML = "";

        // Ordenar certificaciones por fecha (m√°s reciente primero)
        certificacionesUnicas.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

        // Llenar tabla
        certificacionesUnicas.forEach((cert, index) => {
          const fila = document.createElement("tr");

          let calificacionTexto = "No realizado";
          let calificacionClase = "";

          if (cert.examenRealizado) {
            calificacionClase = cert.aprobado ? "calificacion-aprobada" : "calificacion-reprobada";
            calificacionTexto = `${cert.calificacion.toFixed(1)}%`;
          }

          fila.innerHTML = `
            <td>${index + 1}</td>
            <td>${cert.titulo}</td>
            <td>${cert.fecha.toLocaleDateString()}</td>
            <td>${cert.asistenciasCompletadas}/3</td>
            <td>${cert.examenRealizado ? "S√≠" : "No"}</td>
            <td class="${calificacionClase}">${calificacionTexto}</td>
            <td class="${cert.estadoClase}">${cert.estado}</td>
            <td>
                ${cert.examenRealizado ?
              `<button onclick="verCertificacionCompleta('${cert.formularioId}', '${cert.visitanteId}')" 
                             style="background: #17a2b8; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                        Ver Examen
                    </button>`
              : 'No disponible'
            }
            </td>
        `;

          cuerpoTablaCertificaciones.appendChild(fila);
        });
      }
      const tabla = document.getElementById('tablaCertificaciones');
      tabla.querySelector('thead').innerHTML = `
    <tr>
        <th>#</th>
        <th>Especialidad</th>
        <th>Fecha de Participaci√≥n</th>
        <th>Asistencias Completadas</th>
        <th>Examen Realizado</th>
        <th>Calificaci√≥n</th>
        <th>Estado</th>
        <th>Examen</th>
    </tr>
`;



    </script>

</body>

</html>